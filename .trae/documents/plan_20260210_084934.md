# Bilibili 自动评论工具项目规划

针对您的需求，我建议采用 **Python + Playwright** 的技术方案。相比纯 API 方式，浏览器自动化（Playwright）能更真实地模拟用户行为，支持**图片上传**（API 通常对此限制较多），并且在处理**风控验证**（如滑动验证码）时更容易通过人工介入或自动化方案解决。

## 📅 项目阶段规划

### 第一阶段：基础框架搭建 (Foundation)
*   **环境初始化**：建立 Python 虚拟环境，安装 `playwright`, `pytest`, `pyyaml` 等依赖。
*   **配置管理 (`config.yaml`)**：
    *   定义关键词列表。
    *   定义评论内容池（支持多套文案/图片随机选择）。
    *   配置运行参数（间隔时间、最大发送量）。
*   **日志系统**：集成 `loguru`，记录发送成功、失败、报错的详细日志。

### 第二阶段：核心功能实现 (Core Features)
*   **登录模块 (`auth.py`)**：
    *   实现扫码登录（最安全，不易被风控）。
    *   Cookie 的本地保存与自动加载（避免每次重启都登录）。
    *   **账号状态检测**：启动时检查 Cookie 是否失效。
*   **搜索模块 (`search.py`)**：
    *   根据关键词自动访问 B 站搜索页。
    *   筛选视频（如：按发布时间排序、过滤已看过的视频）。
    *   提取视频链接列表。
*   **评论模块 (`comment.py`)**：
    *   自动滚动到评论区。
    *   **图文发送**：模拟点击图片上传按钮 -> 选择本地图片 -> 输入文本 -> 点击发送。
    *   **去重机制**：记录已评论过的视频 ID，避免重复打扰。

### 第三阶段：风控与异常处理 (Risk Control)
*   **行为拟人化**：
    *   随机等待时间（如：输入文字后停顿 2-5 秒）。
    *   模拟鼠标轨迹（可选）。
*   **异常捕获**：
    *   **验证码识别**：检测到滑动验证码时，暂停并提示人工处理，或接入打码平台（后续扩展）。
    *   **账号受限检测**：如果评论发送失败提示“账号异常”或“禁言”，自动停止任务并报警。
    *   **元素定位失败处理**：页面加载慢或改版导致的定位失败重试。

### 第四阶段：整合与交付 (Integration)
*   **主程序 (`main.py`)**：串联登录 -> 搜索 -> 循环评论 -> 异常处理流程。
*   **数据统计**：运行结束后生成简报（成功 N 条，失败 M 条）。

## 🛠️ 技术栈
*   **语言**: Python 3.9+
*   **浏览器自动化**: Playwright (由于其比 Selenium 更快、更稳定，且对现代 Web 元素支持更好)
*   **配置**: YAML/JSON
*   **日志**: Loguru

## ❓ 确认事项
1.  **图片评论**: B 站评论区发图通常需要等级或特定条件，且 Web 端操作是“点击图片图标 -> 上传”。确认您的账号具备此权限。
2.  **验证码**: 遇到强力验证码（如极验）时，默认策略是“挂起程序+声音提醒人工介入”，是否接受？
3.  **开发环境**: 当前是在 Windows 环境下开发，最后是交付源码还是打包成 `.exe`？

确认规划无误后，我将从**第一阶段**开始搭建项目结构。