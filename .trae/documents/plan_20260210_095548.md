# Bilibili 评论区图片上传功能规划

B 站评论区的图片上传通常需要点击“图片图标”触发文件选择，或者直接找到隐藏的 `<input type="file">` 进行注入。为了保证稳定性，我建议采用**双重策略**。

## 🛠️ 技术方案

### 1. 核心逻辑实现 (`core/comment.py`)
我们将重构 `post_comment` 方法中的图片处理部分，实施以下逻辑：

*   **策略 A：隐式 Input 注入 (优先)**
    *   尝试直接定位页面上隐藏的 `input[type='file']` 元素。
    *   如果存在，直接调用 `setInputFiles`，这是最快且最稳定的方式。
    *   *注意：B 站可能会动态渲染这个 Input，只有点击图标后才出现。*

*   **策略 B：显式 UI 交互 (回退)**
    *   定位评论框下方的“图片”图标（通常是 SVG 或特定 Class 按钮）。
    *   设置 `page.expect_file_chooser()` 监听器。
    *   点击图标，触发文件选择框。
    *   将本地图片路径填入拦截到的 `file_chooser`。

*   **等待上传完成**
    *   图片上传不是瞬间完成的。必须检测上传后的**缩略图**或**加载状态**消失，确保图片已附在评论框中，然后再点击发送。

### 2. 配置更新 (`config.yaml`)
*   需要在配置文件中启用 `images` 字段，并指定有效的本地图片路径用于测试。

### 3. 异常处理
*   **权限检测**：如果账号等级不够或在该视频下无发图权限（图标置灰或不存在），记录 Warning 日志并降级为纯文本发送，不中断流程。
*   **格式校验**：确保文件存在且格式支持（jpg/png/gif）。

## 📅 执行步骤
1.  **修改 `core/comment.py`**：实现上述的双重上传策略及等待逻辑。
2.  **创建测试资源**：在 `assets` 目录下放置一张测试图片。
3.  **更新 `config.yaml`**：配置测试图片路径。
4.  **验证**：运行程序，观察是否能成功上传并发送带图评论。

准备就绪，请确认是否开始执行？